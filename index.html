
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <meta
            name="description"
            content="Write Dart"
        >
    <title>Write Dart</title>

    <style media="screen">
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cpf {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s, .highlight .sa, .highlight .dl {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf, .highlight .fm {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv, .highlight .vm {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .nl {
  color: #f92672;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <style media="print">
      * {
        -webkit-transition:none!important;
        transition:none!important;
      }
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #586e75;
}
.highlight .err {
  color: #002b36;
  background-color: #dc322f;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cm, .highlight .cpf, .highlight .c1, .highlight .cs {
  color: #657b83;
}
.highlight .cp {
  color: #b58900;
}
.highlight .nt {
  color: #b58900;
}
.highlight .o, .highlight .ow {
  color: #93a1a1;
}
.highlight .p, .highlight .pi {
  color: #93a1a1;
}
.highlight .gi {
  color: #859900;
}
.highlight .gd {
  color: #dc322f;
}
.highlight .gh {
  color: #268bd2;
  background-color: #002b36;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #6c71c4;
}
.highlight .kc {
  color: #cb4b16;
}
.highlight .kt {
  color: #cb4b16;
}
.highlight .kd {
  color: #cb4b16;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .dl, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #859900;
}
.highlight .sa {
  color: #6c71c4;
}
.highlight .sr {
  color: #2aa198;
}
.highlight .si {
  color: #d33682;
}
.highlight .se {
  color: #d33682;
}
.highlight .nn {
  color: #b58900;
}
.highlight .nc {
  color: #b58900;
}
.highlight .no {
  color: #b58900;
}
.highlight .na {
  color: #268bd2;
}
.highlight .m, .highlight .mb, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mx {
  color: #859900;
}
.highlight .ss {
  color: #859900;
}
    </style>
    <link href="stylesheets/screen-8d7795d9.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print-7393aaf6.css" rel="stylesheet" media="print" />
      <script src="javascripts/all-b12a2749.js"></script>

    <script>
      $(function() { setupCodeCopy(); });
    </script>
  </head>

  <body class="index" data-languages="[&quot;dart&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar-cad8cdcb.png" alt="" />
      </span>
    </a>
    <div class="toc-wrapper">
      <div style="color: white; font-size: 2rem; text-align: center; padding-top: 1rem;">Write <span style="color: #0384fc;">Dart</span></div>
        <div class="lang-selector">
              <a href="#" data-language-name="dart">dart</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#45fa4e00db" class="toc-h1 toc-link" data-title="介绍">介绍</a>
          </li>
          <li>
            <a href="#future" class="toc-h1 toc-link" data-title="Future">Future</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#long-chain" class="toc-h2 toc-link" data-title="long-chain">long-chain</a>
                  </li>
                  <li>
                    <a href="#then-catch" class="toc-h2 toc-link" data-title="then-catch">then-catch</a>
                  </li>
                  <li>
                    <a href="#comprehensive-errors" class="toc-h2 toc-link" data-title="comprehensive-errors">comprehensive-errors</a>
                  </li>
                  <li>
                    <a href="#throws-then-catch" class="toc-h2 toc-link" data-title="throws-then-catch">throws-then-catch</a>
                  </li>
                  <li>
                    <a href="#connect-server" class="toc-h2 toc-link" data-title="connect-server">connect-server</a>
                  </li>
                  <li>
                    <a href="#future-then-amp-future-catch-error" class="toc-h2 toc-link" data-title="future-then &amp; future-catch-error">future-then &amp; future-catch-error</a>
                  </li>
                  <li>
                    <a href="#26b238cb1d" class="toc-h2 toc-link" data-title="注意事项">注意事项</a>
                  </li>
                  <li>
                    <a href="#auth-response" class="toc-h2 toc-link" data-title="auth-response">auth-response</a>
                  </li>
                  <li>
                    <a href="#early-error-handler" class="toc-h2 toc-link" data-title="early error handler">early error handler</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#utils" class="toc-h1 toc-link" data-title="Utils">Utils</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#a-simple-logger" class="toc-h2 toc-link" data-title="A simple logger">A simple logger</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#async" class="toc-h1 toc-link" data-title="async">async</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#e873fcf64e" class="toc-h2 toc-link" data-title="以下三个函数有何区别？">以下三个函数有何区别？</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#questions" class="toc-h1 toc-link" data-title="Questions">Questions</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#never" class="toc-h2 toc-link" data-title="Never 是什么？">Never 是什么？</a>
                  </li>
                  <li>
                    <a href="#dart-dynamic-object" class="toc-h2 toc-link" data-title="Dart 中 dynamic 和 Object 有何区别？">Dart 中 dynamic 和 Object 有何区别？</a>
                  </li>
              </ul>
          </li>
      </ul>
        <ul class="toc-footer">
            <li><a href='#'>主页</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='45fa4e00db'>介绍</h1>
<p>此页面用以记录 Dart 学习过程中的代码片段和概念。</p>

<blockquote>
<p>Dart 打印 <code>Hello world!</code>。</p>
</blockquote>
<div class="highlight"><pre class="highlight dart tab-dart"><code><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">print</span><span class="p">(</span><span class="s">'Hello world!'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<aside class="notice">
这是一个 <code>Notice</code> 示例。
</aside>

<aside class="success">
这是一个 <code>Success</code> 示例。
</aside>

<aside class="warning">
这是一个 <code>Warning</code> 示例。
</aside>
<h1 id='future'>Future</h1><h2 id='long-chain'>long-chain</h2><div class="highlight"><pre class="highlight dart tab-dart"><code><span class="n">Future</span><span class="p">&lt;</span><span class="kt">String</span><span class="p">&gt;</span> <span class="n">one</span><span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">Future</span><span class="o">.</span><span class="na">value</span><span class="p">(</span><span class="s">'from one'</span><span class="p">);</span>
<span class="n">Future</span><span class="p">&lt;</span><span class="kt">String</span><span class="p">&gt;</span> <span class="n">two</span><span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">Future</span><span class="o">.</span><span class="na">error</span><span class="p">(</span><span class="s">'error from two'</span><span class="p">);</span>
<span class="n">Future</span><span class="p">&lt;</span><span class="kt">String</span><span class="p">&gt;</span> <span class="n">three</span><span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">Future</span><span class="o">.</span><span class="na">value</span><span class="p">(</span><span class="s">'from three'</span><span class="p">);</span>
<span class="n">Future</span><span class="p">&lt;</span><span class="kt">String</span><span class="p">&gt;</span> <span class="n">four</span><span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">Future</span><span class="o">.</span><span class="na">value</span><span class="p">(</span><span class="s">'from four'</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">one</span><span class="p">()</span> <span class="c1">// Future completes with "from one".</span>
      <span class="o">.</span><span class="na">then</span><span class="p">((</span><span class="n">_</span><span class="p">)</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">two</span><span class="p">())</span> <span class="c1">// Future completes with two()'s error.</span>
      <span class="o">.</span><span class="na">then</span><span class="p">((</span><span class="n">_</span><span class="p">)</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">three</span><span class="p">())</span> <span class="c1">// Future completes with two()'s error.</span>
      <span class="o">.</span><span class="na">then</span><span class="p">((</span><span class="n">_</span><span class="p">)</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">four</span><span class="p">())</span> <span class="c1">// Future completes with two()'s error.</span>
      <span class="o">.</span><span class="na">then</span><span class="p">((</span><span class="n">value</span><span class="p">)</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">value</span><span class="o">.</span><span class="na">length</span><span class="p">)</span> <span class="c1">// Future completes with two()'s error.</span>
      <span class="o">.</span><span class="na">catchError</span><span class="p">((</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">print</span><span class="p">(</span><span class="s">'Got error: </span><span class="si">$e</span><span class="s">'</span><span class="p">);</span> <span class="c1">// Finally, callback fires.</span>
    <span class="k">return</span> <span class="mi">42</span><span class="p">;</span> <span class="c1">// Future completes with 42.</span>
  <span class="p">})</span><span class="o">.</span><span class="na">then</span><span class="p">((</span><span class="n">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">print</span><span class="p">(</span><span class="s">'The value is </span><span class="si">$value</span><span class="s">'</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="c1">// Output of this program:</span>
<span class="c1">//   Got error: error from two</span>
<span class="c1">//   The value is 42</span>

</code></pre></div><h2 id='then-catch'>then-catch</h2><div class="highlight"><pre class="highlight dart tab-dart"><code><span class="n">Future</span><span class="p">&lt;</span><span class="kt">Object</span><span class="p">&gt;</span> <span class="n">myFunc</span><span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">Future</span><span class="o">.</span><span class="na">value</span><span class="p">(</span><span class="s">'42'</span><span class="p">);</span>

<span class="kt">String</span> <span class="nf">processValue</span><span class="p">(</span><span class="kd">dynamic</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="s">'value'</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Future</span><span class="p">&lt;</span><span class="kt">String</span><span class="p">&gt;</span> <span class="n">handleError</span><span class="p">(</span><span class="kd">dynamic</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">Future</span><span class="o">.</span><span class="na">value</span><span class="p">(</span><span class="s">'value'</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">myFunc</span><span class="p">()</span><span class="o">.</span><span class="na">then</span><span class="p">(</span><span class="n">processValue</span><span class="p">)</span><span class="o">.</span><span class="na">catchError</span><span class="p">(</span><span class="n">handleError</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><h2 id='comprehensive-errors'>comprehensive-errors</h2><div class="highlight"><pre class="highlight dart tab-dart"><code><span class="n">Future</span><span class="p">&lt;</span><span class="kt">Object</span><span class="p">&gt;</span> <span class="n">myFunc</span><span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">Future</span><span class="o">.</span><span class="na">value</span><span class="p">(</span><span class="s">'42'</span><span class="p">);</span>

<span class="kt">String</span> <span class="nf">doSomethingWith</span><span class="p">(</span><span class="kd">dynamic</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="s">'value'</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Future</span><span class="p">&lt;</span><span class="kt">String</span><span class="p">&gt;</span> <span class="n">handleError</span><span class="p">(</span><span class="kd">dynamic</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">Future</span><span class="o">.</span><span class="na">value</span><span class="p">(</span><span class="s">'value'</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">Never</span> <span class="n">ellipsis</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="k">throw</span> <span class="n">Exception</span><span class="p">(</span><span class="s">'!'</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">myFunc</span><span class="p">()</span><span class="o">.</span><span class="na">then</span><span class="p">((</span><span class="n">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">doSomethingWith</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
    <span class="n">ellipsis</span><span class="p">();</span> <span class="c1">// 抛出异常</span>
    <span class="c1">// 下面代码不会被执行</span>
    <span class="k">throw</span> <span class="n">Exception</span><span class="p">(</span><span class="s">'Some arbitrary error'</span><span class="p">);</span>
  <span class="p">})</span><span class="o">.</span><span class="na">catchError</span><span class="p">(</span><span class="n">handleError</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><h2 id='throws-then-catch'>throws-then-catch</h2><div class="highlight"><pre class="highlight dart tab-dart"><code><span class="n">Future</span><span class="p">&lt;</span><span class="kt">Object</span><span class="p">&gt;</span> <span class="n">asyncErrorFunction</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
  <span class="k">throw</span> <span class="n">Exception</span><span class="p">(</span><span class="s">'Threw an exception'</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">Future</span><span class="p">&lt;</span><span class="kt">Object</span><span class="p">&gt;</span> <span class="n">anotherAsyncErrorFunction</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">throw</span> <span class="n">Exception</span><span class="p">(</span><span class="s">'Also threw an exception'</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">Object</span> <span class="nf">successCallback</span><span class="p">(</span><span class="kd">dynamic</span> <span class="n">value</span><span class="p">)</span> <span class="kd">async</span> <span class="p">{</span>
  <span class="k">return</span> <span class="s">''</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Future</span><span class="p">&lt;</span><span class="kt">String</span><span class="p">&gt;</span> <span class="n">handleError</span><span class="p">(</span><span class="kd">dynamic</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">print</span><span class="p">(</span><span class="n">error</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">Future</span><span class="o">.</span><span class="na">value</span><span class="p">(</span><span class="s">'value'</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">asyncErrorFunction</span><span class="p">()</span><span class="o">.</span><span class="na">then</span><span class="p">(</span><span class="n">successCallback</span><span class="p">,</span> <span class="nl">onError:</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">handleError</span><span class="p">(</span><span class="n">e</span><span class="p">);</span> <span class="c1">// Original error. 显示捕获异常，不然后面的 catchError 不会再捕获</span>
    <span class="n">anotherAsyncErrorFunction</span><span class="p">();</span> <span class="c1">// Oops, new error.</span>
  <span class="p">})</span><span class="o">.</span><span class="na">catchError</span><span class="p">(</span><span class="n">handleError</span><span class="p">);</span> <span class="c1">// Error from within then() handled.</span>
<span class="p">}</span>
<span class="c1">// Exception: Threw an exception</span>
<span class="c1">// Exception: Also threw an exception</span>
</code></pre></div><h2 id='connect-server'>connect-server</h2><div class="highlight"><pre class="highlight dart tab-dart"><code><span class="n">Future</span><span class="p">&lt;</span><span class="kt">Object</span><span class="p">&gt;</span> <span class="n">handleResponse</span><span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">Future</span><span class="o">.</span><span class="na">value</span><span class="p">(</span><span class="s">'Response'</span><span class="p">);</span>

<span class="n">Future</span><span class="p">&lt;</span><span class="kt">String</span><span class="p">&gt;</span> <span class="n">handleError</span><span class="p">(</span><span class="kd">dynamic</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">Future</span><span class="o">.</span><span class="na">value</span><span class="p">(</span><span class="s">'value'</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">dynamic</span> <span class="n">connectToServer</span><span class="p">()</span> <span class="p">{}</span>
  <span class="kd">const</span> <span class="n">myUrl</span> <span class="o">=</span> <span class="s">'https://dart.dev'</span><span class="p">;</span>

  <span class="kd">final</span> <span class="n">server</span> <span class="o">=</span> <span class="n">connectToServer</span><span class="p">();</span>
  <span class="n">server</span>
      <span class="o">.</span><span class="na">post</span><span class="p">(</span><span class="n">myUrl</span><span class="p">,</span> <span class="nl">fields:</span> <span class="kd">const</span> <span class="p">{</span><span class="s">'name'</span><span class="o">:</span> <span class="s">'Dash'</span><span class="p">,</span> <span class="s">'profession'</span><span class="o">:</span> <span class="s">'mascot'</span><span class="p">})</span>
      <span class="o">.</span><span class="na">then</span><span class="p">(</span><span class="n">handleResponse</span><span class="p">)</span>
      <span class="o">.</span><span class="na">catchError</span><span class="p">(</span><span class="n">handleError</span><span class="p">)</span>
      <span class="o">.</span><span class="na">whenComplete</span><span class="p">(</span><span class="n">server</span><span class="o">.</span><span class="na">close</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><h2 id='future-then-amp-future-catch-error'>future-then &amp; future-catch-error</h2><div class="highlight"><pre class="highlight dart tab-dart"><code><span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">FakeFuture</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="p">{</span>
  <span class="n">Future</span><span class="p">&lt;</span><span class="n">R</span><span class="p">&gt;</span> <span class="n">then</span><span class="p">&lt;</span><span class="n">R</span><span class="p">&gt;(</span><span class="n">FutureOr</span><span class="p">&lt;</span><span class="n">R</span><span class="p">&gt;</span> <span class="kt">Function</span><span class="p">(</span><span class="n">T</span> <span class="n">value</span><span class="p">)</span> <span class="n">onValue</span><span class="p">,</span> <span class="p">{</span><span class="kt">Function</span><span class="o">?</span> <span class="n">onError</span><span class="p">});</span>

  <span class="n">Future</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">catchError</span><span class="p">(</span><span class="kt">Function</span> <span class="n">onError</span><span class="p">,</span> <span class="p">{</span><span class="kt">bool</span> <span class="kt">Function</span><span class="p">(</span><span class="kt">Object</span> <span class="n">error</span><span class="p">)</span><span class="o">?</span> <span class="n">test</span><span class="p">});</span>
<span class="p">}</span>
</code></pre></div>
<blockquote>
<p>test 返回值为 true，onError 才会执行：</p>
</blockquote>
<div class="highlight"><pre class="highlight dart tab-dart"><code><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Future</span><span class="o">.</span><span class="na">delayed</span><span class="p">(</span>
    <span class="kd">const</span> <span class="n">Duration</span><span class="p">(</span><span class="nl">seconds:</span> <span class="mi">1</span><span class="p">),</span>
    <span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="k">throw</span> <span class="mi">401</span><span class="p">,</span>
  <span class="p">)</span><span class="o">.</span><span class="na">then</span><span class="p">((</span><span class="n">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="s">'Unreachable'</span><span class="p">;</span>
  <span class="p">})</span><span class="o">.</span><span class="na">catchError</span><span class="p">((</span><span class="n">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">print</span><span class="p">(</span><span class="s">'Error: </span><span class="si">$err</span><span class="s">'</span><span class="p">);</span> <span class="c1">// Prints 401.</span>
  <span class="p">},</span> <span class="nl">test:</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">error</span> <span class="k">is</span> <span class="kt">int</span> <span class="o">&amp;&amp;</span> <span class="n">error</span> <span class="p">&gt;</span><span class="o">=</span> <span class="mi">400</span><span class="p">;</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></div><h2 id='26b238cb1d'>注意事项</h2>
<p>以下代码会抛出异常 <code>ArgumentError</code>：<code>Invalid argument(s) (onError): The error handler of Future.catchError must return a value of the future&#39;s type</code>，因为编译器推断 <code>then()</code> 的返回值类型是 <code>Future&lt;Never&gt;</code> 或 <code>Future&lt;Null&gt;</code>，然而真正的返回类型并不如此。</p>

<p>修改方法：<code>then()</code> 添加返回类型 <code>void</code>，告诉编译器无返回值。</p>
<div class="highlight"><pre class="highlight dart tab-dart"><code><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// error</span>
  <span class="n">Future</span><span class="p">(()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="na">then</span><span class="p">((</span><span class="n">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="n">Exception</span><span class="p">(</span><span class="s">'1'</span><span class="p">);</span>
  <span class="p">})</span><span class="o">.</span><span class="na">catchError</span><span class="p">((</span><span class="n">error</span><span class="p">,</span> <span class="n">stackTrace</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">print</span><span class="p">(</span><span class="s">'</span><span class="si">$error</span><span class="s">, </span><span class="si">$stackTrace</span><span class="s">'</span><span class="p">);</span>
  <span class="p">});</span>
  <span class="c1">// error</span>
  <span class="n">File</span><span class="p">(</span><span class="s">"foo.txt"</span><span class="p">)</span><span class="o">.</span><span class="na">readAsString</span><span class="p">()</span><span class="o">.</span><span class="na">catchError</span><span class="p">((</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">print</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="c1">// ok</span>
  <span class="n">Future</span><span class="p">(()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="na">then</span><span class="p">&lt;</span><span class="kt">void</span><span class="p">&gt;((</span><span class="n">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="n">Exception</span><span class="p">(</span><span class="s">'1'</span><span class="p">);</span>
  <span class="p">})</span><span class="o">.</span><span class="na">catchError</span><span class="p">((</span><span class="n">error</span><span class="p">,</span> <span class="n">stackTrace</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">print</span><span class="p">(</span><span class="s">'</span><span class="si">$error</span><span class="s">, </span><span class="si">$stackTrace</span><span class="s">'</span><span class="p">);</span>
  <span class="p">});</span>
  <span class="c1">// ok</span>
  <span class="n">File</span><span class="p">(</span><span class="s">"foo.txt"</span><span class="p">)</span><span class="o">.</span><span class="na">readAsString</span><span class="p">()</span><span class="o">.</span><span class="na">then</span><span class="p">&lt;</span><span class="kt">void</span><span class="p">&gt;((</span><span class="n">value</span><span class="p">)</span> <span class="p">{})</span><span class="o">.</span><span class="na">catchError</span><span class="p">((</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">print</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></div>
<p>另外也可是使用 <code>try-catch</code>。</p>
<div class="highlight"><pre class="highlight dart tab-dart"><code><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">File</span><span class="p">(</span><span class="s">"foo.txt"</span><span class="p">)</span><span class="o">.</span><span class="na">readAsString</span><span class="p">();</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">print</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h2 id='auth-response'>auth-response</h2><div class="highlight"><pre class="highlight dart tab-dart"><code><span class="kn">import</span> <span class="s">'dart:async'</span><span class="o">;</span>

<span class="n">Future</span><span class="p">&lt;</span><span class="kt">Object</span><span class="p">&gt;</span> <span class="n">handleAuthResponse</span><span class="p">(</span><span class="kt">Map</span><span class="p">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kd">dynamic</span><span class="p">&gt;</span> <span class="n">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">Future</span><span class="o">.</span><span class="na">value</span><span class="p">(</span><span class="s">'Response'</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">handleFormatException</span><span class="p">(</span><span class="kt">Object</span> <span class="n">exception</span><span class="p">)</span> <span class="p">{}</span>

<span class="kt">void</span> <span class="nf">handleAuthorizationException</span><span class="p">(</span><span class="kt">Object</span> <span class="n">exception</span><span class="p">)</span> <span class="p">{}</span>

<span class="kd">class</span> <span class="nc">AuthorizationException</span> <span class="kd">implements</span> <span class="n">Exception</span> <span class="p">{}</span>

<span class="kt">Never</span> <span class="n">ellipsis</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="k">throw</span> <span class="n">AuthorizationException</span><span class="p">();</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">handleAuthResponse</span><span class="p">(</span><span class="kd">const</span> <span class="p">{</span><span class="s">'username'</span><span class="o">:</span> <span class="s">'dash'</span><span class="p">,</span> <span class="s">'age'</span><span class="o">:</span> <span class="mi">3</span><span class="p">})</span>
      <span class="o">.</span><span class="na">then</span><span class="p">&lt;</span><span class="kt">void</span><span class="p">&gt;((</span><span class="n">_</span><span class="p">)</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">ellipsis</span><span class="p">())</span>
      <span class="o">.</span><span class="na">catchError</span><span class="p">(</span><span class="n">handleFormatException</span><span class="p">,</span> <span class="nl">test:</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">e</span> <span class="k">is</span> <span class="n">FormatException</span><span class="p">)</span>
      <span class="o">.</span><span class="na">catchError</span><span class="p">(</span><span class="n">handleAuthorizationException</span><span class="p">,</span> <span class="c1">// go to this branch</span>
          <span class="nl">test:</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">e</span> <span class="k">is</span> <span class="n">AuthorizationException</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><h2 id='early-error-handler'>early error handler</h2>
<p>以下代码，捕获异常比抛出异常推迟 500 ms，所以不能捕获异常。</p>
<div class="highlight"><pre class="highlight dart tab-dart"><code><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Future</span><span class="p">&lt;</span><span class="kt">Object</span><span class="p">&gt;</span> <span class="n">asyncErrorFunction</span><span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="k">throw</span> <span class="n">Exception</span><span class="p">(</span><span class="s">'1'</span><span class="p">);</span>

  <span class="n">Future</span><span class="p">&lt;</span><span class="kt">Object</span><span class="p">&gt;</span> <span class="n">future</span> <span class="o">=</span> <span class="n">asyncErrorFunction</span><span class="p">();</span> <span class="c1">// 已经抛出</span>

  <span class="c1">// BAD: Too late to handle asyncErrorFunction() exception.</span>
  <span class="n">Future</span><span class="o">.</span><span class="na">delayed</span><span class="p">(</span><span class="kd">const</span> <span class="n">Duration</span><span class="p">(</span><span class="nl">milliseconds:</span> <span class="mi">500</span><span class="p">),</span> <span class="p">()</span> <span class="p">{</span>
    <span class="n">future</span><span class="o">.</span><span class="na">then</span><span class="p">((</span><span class="n">_</span><span class="p">)</span> <span class="p">{})</span><span class="o">.</span><span class="na">catchError</span><span class="p">((</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">print</span><span class="p">(</span><span class="s">'e'</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></div>
<p>正确做法是，<code>Future().then().catchError()</code> 写在一起。</p>
<div class="highlight"><pre class="highlight dart tab-dart"><code><span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Future</span><span class="p">&lt;</span><span class="kt">Object</span><span class="p">&gt;</span> <span class="n">asyncErrorFunction</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="n">Exception</span><span class="p">(</span><span class="s">'Threw an exception'</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">Future</span><span class="o">.</span><span class="na">delayed</span><span class="p">(</span><span class="kd">const</span> <span class="n">Duration</span><span class="p">(</span><span class="nl">milliseconds:</span> <span class="mi">500</span><span class="p">),</span> <span class="p">()</span> <span class="p">{</span>
    <span class="n">asyncErrorFunction</span><span class="p">()</span><span class="o">.</span><span class="na">then</span><span class="p">((</span><span class="n">_</span><span class="p">)</span> <span class="p">{})</span><span class="o">.</span><span class="na">catchError</span><span class="p">((</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">print</span><span class="p">(</span><span class="s">'e'</span><span class="p">);</span> <span class="c1">// ok</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></div><h1 id='utils'>Utils</h1><h2 id='a-simple-logger'>A simple logger</h2><div class="highlight"><pre class="highlight dart tab-dart"><code><span class="c1">/// A simple logger</span>
<span class="kd">class</span> <span class="nc">Logger</span> <span class="p">{</span>
  <span class="kd">final</span> <span class="kt">List</span><span class="p">&lt;</span><span class="kt">String</span><span class="p">&gt;</span> <span class="n">_log</span> <span class="o">=</span> <span class="p">[];</span>

  <span class="kt">List</span><span class="p">&lt;</span><span class="kt">String</span><span class="p">&gt;</span> <span class="kd">get</span> <span class="n">log</span> <span class="o">=</span><span class="p">&gt;</span> <span class="kt">List</span><span class="o">.</span><span class="na">from</span><span class="p">(</span><span class="n">_log</span><span class="p">);</span>
  <span class="kt">void</span> <span class="n">clear</span><span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">_log</span><span class="o">.</span><span class="na">clear</span><span class="p">();</span>
  <span class="kt">void</span> <span class="n">print</span><span class="p">(</span><span class="kt">Object</span> <span class="n">o</span><span class="p">)</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">_log</span><span class="o">.</span><span class="na">add</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="na">toString</span><span class="p">());</span>

  <span class="nd">@override</span>
  <span class="kt">String</span> <span class="n">toString</span><span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">_log</span><span class="o">.</span><span class="na">join</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><h1 id='async'>async</h1><h2 id='e873fcf64e'>以下三个函数有何区别？</h2><div class="highlight"><pre class="highlight dart tab-dart"><code><span class="kt">String</span> <span class="nf">processValue</span><span class="p">(</span><span class="kd">dynamic</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="s">'value'</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Future</span><span class="p">&lt;</span><span class="kt">String</span><span class="p">&gt;</span> <span class="n">processValue1</span><span class="p">(</span><span class="kd">dynamic</span> <span class="n">value</span><span class="p">)</span> <span class="kd">async</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">Future</span><span class="o">.</span><span class="na">value</span><span class="p">(</span><span class="s">'value'</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">Future</span><span class="p">&lt;</span><span class="kt">String</span><span class="p">&gt;</span> <span class="n">processValue2</span><span class="p">(</span><span class="kd">dynamic</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">Future</span><span class="o">.</span><span class="na">value</span><span class="p">(</span><span class="s">'value'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>函数 <code>processValue</code> 和 <code>processValue2</code> 相同，它们都是同步操作，<code>Future</code> 可有可无。函数 <code>processValue1</code> 因为使用了 <code>async</code>，所以是异步操作，必须返回 <code>Future</code>。</p>
<h1 id='questions'>Questions</h1><h2 id='never'>Never 是什么？</h2>
<p>Never 是 Dart 中的一个类型，表示没有值。它通常用于表示不可能返回的函数的返回类型。比如函数中途一定会抛出异常的函数。</p>
<div class="highlight"><pre class="highlight dart tab-dart"><code><span class="kt">Never</span> <span class="n">ellipsis</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="k">throw</span> <span class="n">Exception</span><span class="p">(</span><span class="s">'!'</span><span class="p">);</span>
</code></pre></div><h2 id='dart-dynamic-object'>Dart 中 dynamic 和 Object 有何区别？</h2>
<p>在 Dart 中，<code>dynamic</code> 和 <code>Object</code> 都是类型。<code>dynamic</code> 类型是动态类型，这意味着它可以存储任何类型的值。<code>Object</code> 类型是静态类型，这意味着它只能存储 <code>Object</code> 及其子类的值。</p>

<p><code>dynamic</code> 类型通常用于在编译时不知道值类型的场合。例如，以下代码将 <code>dynamic</code> 类型变量 <code>x</code> 初始化为一个字符串：</p>
<div class="highlight"><pre class="highlight plaintext"><code>dynamic x = 'Hello World!';
</code></pre></div>
<p><code>Object</code> 类型通常用于在编译时知道值类型的场合。例如，以下代码将 <code>Object</code> 类型变量 <code>y</code> 初始化为一个字符串：</p>
<div class="highlight"><pre class="highlight plaintext"><code>Object y = 'Hello World!';
</code></pre></div>
<p><code>dynamic</code> 类型比 <code>Object</code> 类型更灵活，但也更不安全。使用 <code>dynamic</code> 类型时，编译器无法检查类型错误，这可能会导致错误。使用 <code>Object</code> 类型时，编译器可以检查类型错误，这有助于确保程序的安全性。</p>

<p>一般来说，在 Dart 中使用 <code>Object</code> 类型而不是 <code>dynamic</code> 类型是更好的做法。但是，在编译时不知道值类型的场合，使用 <code>dynamic</code> 类型是有意义的。</p>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="dart">dart</a>
          </div>
      </div>
    </div>
  </body>
</html>
